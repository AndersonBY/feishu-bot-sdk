# 02 IM Messaging and Media

[中文](../zh/02-im.md) | [Back to English Index](../README_EN.md)

## Covered Modules

- `feishu_bot_sdk.im.messages` -> `MessageService` / `AsyncMessageService`
- `feishu_bot_sdk.im.media` -> `MediaService` / `AsyncMediaService`

## Quick Example

```python
from feishu_bot_sdk import FeishuClient, FeishuConfig, MessageService, MediaService

client = FeishuClient(FeishuConfig(app_id="cli_xxx", app_secret="xxx"))
message = MessageService(client)
media = MediaService(client)

sent = message.send_text(receive_id_type="open_id", receive_id="ou_xxx", text="hello")
image = media.upload_image("demo.png", image_type="message")
message.send(
    receive_id_type="open_id",
    receive_id="ou_xxx",
    msg_type="image",
    content={"image_key": image["image_key"]},
)
```

## `MessageService` API Summary

- Send and reply: `send_text`, `send`, `reply_text`, `reply`
- Edit and recall: `edit`, `recall`, `get`
- History and read users: `list_history`, `query_read_users`
- Forwarding: `forward`, `merge_forward`
- Reaction and pin: `add_reaction`, `list_reactions`, `delete_reaction`, `pin_message`, `unpin_message`, `list_pins`
- Batch messaging: `send_batch`, `send_batch_message`, `delete_batch_message`, `get_batch_message_progress`, `get_batch_message_read_users`
- Urgent messaging: `send_urgent_app`, `send_urgent_sms`, `send_urgent_phone`
- Card operations: `patch_card`, `send_ephemeral_card`, `delete_ephemeral_card`, `delay_update_card`

## `MediaService` API Summary

- Images: `upload_image`, `upload_image_bytes`, `download_image`
- Files: `upload_file`, `upload_file_bytes`, `download_file`
- Message resources: `download_message_resource`

## Common Snippets

Edit message (`msg_type` defaults to `text`):

```python
message.edit("om_xxx", content={"text": "updated content"})
```

Batch message:

```python
message.send_batch_message(
    msg_type="text",
    content={"text": "batch notification"},
    open_ids=["ou_a", "ou_b"],
)
```

Download resource from a message:

```python
data = media.download_message_resource(
    message_id="om_xxx",
    file_key="file_xxx",
    resource_type="file",
)
```

## Async Version

- `AsyncMessageService` and `AsyncMediaService` keep the same method names.
- Call them with `await`.
