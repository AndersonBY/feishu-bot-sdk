# 02 IM Messaging and Media

[中文](../zh/02-im.md) | [Back to English Index](../README_EN.md)

## Covered Modules

- `feishu_bot_sdk.im.messages` -> `MessageService` / `AsyncMessageService`
- `feishu_bot_sdk.im.media` -> `MediaService` / `AsyncMediaService`
- `feishu_bot_sdk.im.content` -> `MessageContent` (message content builder)

## Quick Example

```python
from feishu_bot_sdk import FeishuClient, FeishuConfig, MessageService, MediaService

client = FeishuClient(FeishuConfig(app_id="cli_xxx", app_secret="xxx"))
message = MessageService(client)
media = MediaService(client)

sent = message.send_text(receive_id_type="open_id", receive_id="ou_xxx", text="hello")
print(sent.message_id)
image = media.upload_image("demo.png", image_type="message")
message.send_image(receive_id_type="open_id", receive_id="ou_xxx", image_key=image.image_key)

message.send_markdown(
    receive_id_type="open_id",
    receive_id="ou_xxx",
    markdown="### Daily Report\n\nTask done",
)
```

## `MessageService` API Summary

- Send and reply: `send_text`, `send`, `send_markdown`, `reply_text`, `reply_markdown`, `reply`
- Edit and recall: `edit`, `recall`, `get`
- History and read users: `list_history`, `query_read_users`
- Forwarding: `forward`, `forward_thread`, `merge_forward`
- Follow-up and URL preview: `push_follow_up`, `batch_update_url_previews`
- Reaction and pin: `add_reaction`, `list_reactions`, `delete_reaction`, `pin_message`, `unpin_message`, `list_pins`
- Batch messaging: `send_batch`, `send_batch_message`, `delete_batch_message`, `get_batch_message_progress`, `get_batch_message_read_users`
- Urgent messaging: `send_urgent_app`, `send_urgent_sms`, `send_urgent_phone`
- Card operations: `patch_card`, `send_ephemeral_card`, `delete_ephemeral_card`, `delay_update_card`
- Multi-type quick send: `send_markdown`, `send_post`, `send_image`, `send_interactive`, `send_share_chat`, `send_share_user`, `send_audio`, `send_media`, `send_file`, `send_sticker`, `send_system`, `send_system_divider`

## `MessageContent` Builder

- Basic: `text`, `image`, `file`, `media`, `audio`, `sticker`, `share_chat`, `share_user`
- Cards: `interactive`, `interactive_card`, `interactive_template`
- Rich text post:
  - Payload level: `post`, `post_locale`
  - Node level: `post_text`, `post_link`, `post_at`, `post_image`, `post_media`, `post_emotion`, `post_code_block`, `post_hr`, `post_md`
- System message: `system`, `system_divider`

## `MediaService` API Summary

- Images: `upload_image`, `upload_image_bytes`, `download_image`
- Files: `upload_file`, `upload_file_bytes`, `download_file`
- Message resources: `download_message_resource`

## Common Snippets

Edit message (`msg_type` defaults to `text`):

```python
message.edit("om_xxx", content={"text": "updated content"})
```

Batch message:

```python
message.send_batch_message(
    msg_type="text",
    content={"text": "batch notification"},
    open_ids=["ou_a", "ou_b"],
)
```

Download resource from a message:

```python
data = media.download_message_resource(
    message_id="om_xxx",
    file_key="file_xxx",
    resource_type="file",
)
```

## Async Version

- `AsyncMessageService` and `AsyncMediaService` keep the same method names.
- Call them with `await`.
