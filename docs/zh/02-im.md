# 02 IM 消息与媒体

[English](../en/02-im.md) | [返回中文索引](../README.md)

## 覆盖模块

- `feishu_bot_sdk.im.messages` -> `MessageService` / `AsyncMessageService`
- `feishu_bot_sdk.im.media` -> `MediaService` / `AsyncMediaService`

## 快速示例

```python
from feishu_bot_sdk import FeishuClient, FeishuConfig, MessageService, MediaService

client = FeishuClient(FeishuConfig(app_id="cli_xxx", app_secret="xxx"))
message = MessageService(client)
media = MediaService(client)

sent = message.send_text(receive_id_type="open_id", receive_id="ou_xxx", text="你好")
image = media.upload_image("demo.png", image_type="message")
message.send(
    receive_id_type="open_id",
    receive_id="ou_xxx",
    msg_type="image",
    content={"image_key": image["image_key"]},
)
```

## `MessageService` API 一览

- 发送与回复：`send_text`、`send`、`reply_text`、`reply`
- 编辑与撤回：`edit`、`recall`、`get`
- 历史与已读：`list_history`、`query_read_users`
- 转发：`forward`、`merge_forward`
- 表情与 Pin：`add_reaction`、`list_reactions`、`delete_reaction`、`pin_message`、`unpin_message`、`list_pins`
- 批量消息：`send_batch`、`send_batch_message`、`delete_batch_message`、`get_batch_message_progress`、`get_batch_message_read_users`
- 加急消息：`send_urgent_app`、`send_urgent_sms`、`send_urgent_phone`
- 卡片：`patch_card`、`send_ephemeral_card`、`delete_ephemeral_card`、`delay_update_card`

## `MediaService` API 一览

- 图片：`upload_image`、`upload_image_bytes`、`download_image`
- 文件：`upload_file`、`upload_file_bytes`、`download_file`
- 消息资源下载：`download_message_resource`

## 常用片段

编辑消息（`msg_type` 默认 `text`）：

```python
message.edit("om_xxx", content={"text": "更新后的内容"})
```

批量发送：

```python
message.send_batch_message(
    msg_type="text",
    content={"text": "批量通知"},
    open_ids=["ou_a", "ou_b"],
)
```

下载消息中文件资源：

```python
data = media.download_message_resource(
    message_id="om_xxx",
    file_key="file_xxx",
    resource_type="file",
)
```

## 异步版

- `AsyncMessageService`、`AsyncMediaService` 与同步方法名保持一致。
- 仅调用方式改为 `await`。
